---
import { NAV_LINKS, SITE } from "../consts";
import ThemeToggle from "./ThemeToggle.astro";

const currentPath = Astro.url.pathname;
---

<nav
  class="fixed top-0 w-full z-50 bg-white/80 dark:bg-surface-950/80 backdrop-blur-lg border-b border-surface-200 dark:border-surface-700"
  aria-label="Main navigation"
>
  <div class="section-container flex items-center justify-between h-16">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 font-display font-bold text-lg">
      <span
        class="w-8 h-8 rounded-lg bg-brand-600 text-white flex items-center justify-center text-sm font-bold"
        aria-hidden="true"
      >
        AS
      </span>
      <span class="hidden sm:inline">{SITE.title}</span>
    </a>

    <!-- Desktop nav -->
    <div class="hidden md:flex items-center gap-1">
      {NAV_LINKS.map((link) => (
        <a
          href={link.href}
          class:list={[
            "px-3 py-2 rounded-lg text-sm font-medium transition-colors",
            currentPath.startsWith(link.href)
              ? "text-brand-600 dark:text-brand-400 bg-brand-50 dark:bg-brand-900/20"
              : "text-surface-700 dark:text-surface-200 hover:text-brand-600 dark:hover:text-brand-400 hover:bg-surface-100 dark:hover:bg-surface-800",
          ]}
          aria-current={currentPath.startsWith(link.href) ? "page" : undefined}
        >
          {link.label}
        </a>
      ))}
      <ThemeToggle />
    </div>

    <!-- Mobile menu button -->
    <div class="flex items-center gap-2 md:hidden">
      <ThemeToggle />
      <button
        id="mobile-menu-btn"
        class="p-2 rounded-lg text-surface-700 dark:text-surface-200 hover:bg-surface-100 dark:hover:bg-surface-800"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Toggle navigation menu"
      >
        <svg class="w-5 h-5" id="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg class="w-5 h-5 hidden" id="close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-surface-200 dark:border-surface-700 bg-white dark:bg-surface-950"
  >
    <div class="section-container py-4 space-y-1">
      {NAV_LINKS.map((link) => (
        <a
          href={link.href}
          class:list={[
            "block px-4 py-2 rounded-lg text-sm font-medium transition-colors",
            currentPath.startsWith(link.href)
              ? "text-brand-600 dark:text-brand-400 bg-brand-50 dark:bg-brand-900/20"
              : "text-surface-700 dark:text-surface-200 hover:bg-surface-100 dark:hover:bg-surface-800",
          ]}
        >
          {link.label}
        </a>
      ))}
    </div>
  </div>
</nav>

<div class="h-16" aria-hidden="true"></div>

<script>
  const btn = document.getElementById("mobile-menu-btn")!;
  const menu = document.getElementById("mobile-menu")!;
  const menuIcon = document.getElementById("menu-icon")!;
  const closeIcon = document.getElementById("close-icon")!;

  btn.addEventListener("click", () => {
    const expanded = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", String(!expanded));
    menu.classList.toggle("hidden");
    menuIcon.classList.toggle("hidden");
    closeIcon.classList.toggle("hidden");
  });
</script>
