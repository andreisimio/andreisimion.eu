---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CtaSection from "../../components/CtaSection.astro";
import { getCollection, render } from "astro:content";
import { SITE } from "../../consts";

export async function getStaticPaths() {
  const studies = await getCollection("case-studies");
  return studies.map((study) => ({
    params: { slug: study.id },
    props: { study },
  }));
}

const { study } = Astro.props;
const { Content } = await render(study);
---

<BaseLayout title={study.data.title} description={study.data.description}>
  <article>
    <section class="bg-surface-100 dark:bg-surface-900 section-padding">
      <div class="section-container">
        <a
          href="/case-studies"
          class="inline-flex items-center gap-1 text-sm text-muted hover:text-brand-600 dark:hover:text-brand-400 mb-6"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Case Studies
        </a>
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="px-3 py-1 text-xs font-medium rounded-full bg-brand-100 text-brand-700 dark:bg-brand-900/30 dark:text-brand-300">
            {study.data.industry}
          </span>
          {study.data.tags.map((tag) => (
            <span class="px-3 py-1 text-xs font-medium rounded-full bg-surface-200 text-surface-700 dark:bg-surface-800 dark:text-surface-200">
              {tag}
            </span>
          ))}
        </div>
        <h1 class="heading-1 mb-4">{study.data.title}</h1>
        <p class="text-muted text-lg max-w-2xl">{study.data.description}</p>
        <p class="text-sm text-muted mt-2">Client: {study.data.client}</p>
      </div>
    </section>

    <!-- Results summary -->
    <section class="section-container py-8">
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {study.data.results.map((result) => (
          <div class="card p-4 text-center">
            <svg class="w-6 h-6 text-green-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-sm font-medium">{result}</p>
          </div>
        ))}
      </div>
    </section>

    <section class="section-container section-padding">
      <div class="max-w-3xl mx-auto prose-custom">
        <Content />
      </div>
    </section>
  </article>

  <!-- Case study structured data -->
  <script
    type="application/ld+json"
    set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Article",
      headline: study.data.title,
      description: study.data.description,
      author: { "@type": "Person", name: SITE.author, url: SITE.url },
      datePublished: study.data.date.toISOString(),
    })}
  />

  <CtaSection />
</BaseLayout>
